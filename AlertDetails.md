# Metric Alerts Details

The following metric alerts have been defined and can deployed within your landing zones via Azure Policy.

Placeholders have been added for future work which will define Alert Processing Rules, Action Groups.

## Alert Processing Rules

<<TBD>>

## Action Groups

<<TBD>>

## Metric Alerts Settings

The values shown for Aggregation, Operator, Threshold, WindowSize, Frequency and Severity have been derived from field and what we've seen from other customers, we encourage you to adjust these threshold to match your environment.


| Component                                | Path                                                                                                                                                                                    | Metric                                            | Aggregation   | Operator           | Threshold   | WindowSize   | Frequency   | Dimensions   | Severity   | <div style="width:240px">References</div>                                                                                                                                                                                                         |
|:-----------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------:|:-------------:|:------------------:|:-----------:|:------------:|:-----------:|:------------:|:----------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| microsoft.network/expressroutecircuits   | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-ercir_bgpavailability_alert.bicep                 | BgpAvailability                                   | Average       | LessThan           | 90          | PT5M         | PT1M        |              | 0          | <br/>[Monitor ExpressRoute Alerts](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#alerts)<br/>[ExpressRoute KQL Queries](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#sample-kusto-queries) |
| microsoft.network/expressroutecircuits   | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-ercir_arpavailability_alert.bicep                 | ArpAvailability                                   | Average       | LessThan           | 90          | PT5M         | PT1M        |              | 0          | <br/>[Monitor ExpressRoute Alerts](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#alerts)<br/>[ExpressRoute KQL Queries](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#sample-kusto-queries) |
| microsoft.network/expressroutecircuits   | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-ercir_qosdropsbitsin_alert.bicep                  | QosDropBitsInPerSecond                            | Average       | GreaterThan        | 100         | PT5M         | PT1M        |              | 2          | <br/>[Monitor ExpressRoute Alerts](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#alerts)<br/>[ExpressRoute KQL Queries](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#sample-kusto-queries) |
| microsoft.network/expressroutecircuits   | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-ercir_qosdropsbitsout_alert.bicep                 | QosDropBitsOutPerSecond                           | Average       | GreaterThan        | 100         | PT5M         | PT1M        |              | 2          | <br/>[Monitor ExpressRoute Alerts](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#alerts)<br/>[ExpressRoute KQL Queries](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#sample-kusto-queries) |
| Microsoft.KeyVault/vaults                | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-kv_availability_alert.bicep                       | Availability                                      | Average       | LessThan           | 90          | PT5M         | PT1M        |              | 1          |                                                                                                                                                                                                                                                   |
| Microsoft.KeyVault/vaults                | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-kv_capacity_alert.bicep                           | SaturationShoebox                                 | Average       | GreaterThan        | 75          | PT5M         | PT1M        |              | 1          |                                                                                                                                                                                                                                                   |
| Microsoft.KeyVault/vaults                | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-kv_latency_alert.bicep                            | ServiceApiLatency                                 | Average       | GreaterThan        | 1000        | PT5M         | PT1M        |              | 3          |                                                                                                                                                                                                                                                   |
| Microsoft.KeyVault/vaults                | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-kv_requests_alert.bicep                           | ServiceApiResult                                  | Average       | GreaterThan        | dynamic     | PT5M         | PT1M        |              | 2          |                                                                                                                                                                                                                                                   |
| Microsoft.Automation/automationAccounts  | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-aa_totaljob_alert.bicep                           | TotalJob                                          | Count         | GreaterThan        | 0           | PT5M         | PT1M        |              | 2          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/azureFirewalls         | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-afw_firewallhealth_alert.bicep                    | FirewallHealth                                    | Average       | LessThan           | 90          | PT5M         | PT1M        |              | 0          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/azureFirewalls         | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-afw_snatportutilization_alert.bicep               | SNATPortUtilization                               | Average       | GreaterThan        | 80          | PT5M         | PT1M        |              | 1          |                                                                                                                                                                                                                                                   |
| microsoft.network/vpngateways            | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vpng_bgppeerstatus_alert.bicep                    | BgpPeerStatus                                     | Total         | LessThan           | 1           | PT5M         | PT5M        |              |            |                                                                                                                                                                                                                                                   |
| microsoft.network/vpngateways            | https://github.com/Azure/alz-monitor/blob/fdd0ab013ee6f35a53e130384734e20c0a722b54/Observability_L100/Deploy/policyDefinitions/deploy-vpng_ingresspacketdropmismatch_alert.bicep        | TunnelIngressPacketDropTSMismatch                 | Average       | GreaterThan        | dynamic     | PT5M         | PT5M        |              | 3          |                                                                                                                                                                                                                                                   |
| microsoft.network/vpngateways            | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-vpng_egresspacketdropcount_alert.bicep            | TunnelEgressPacketDropCount                       | Total         | GreaterThan        | dynamic     | PT5M         | PT5M        |              | 3          |                                                                                                                                                                                                                                                   |
| microsoft.network/vpngateways            | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-vpng_ingresspacketdropcount_alert.bicep           | TunnelIngressPacketDropCount                      | Total         | GreaterThan        | dynamic     | PT5M         | PT5M        |              | 3          |                                                                                                                                                                                                                                                   |
| microsoft.network/vpngateways            | https://github.com/Azure/alz-monitor/blob/fdd0ab013ee6f35a53e130384734e20c0a722b54/Observability_L100/Deploy/policyDefinitions/deploy-vpng_egresspacketdropmismatch_alert.bicep         | TunnelEgressPacketDropTSMismatch                  | Total         | GreaterThan        | dynamic     | PT5M         | PT5M        |              | 3          |                                                                                                                                                                                                                                                   |
| microsoft.network/virtualNetworkGateways | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vnetg_expressroutecpuutilization_alert.bicep      | ExpressRouteGatewayCpuUtilization                 | Average       | GreaterThan        | 90          | PT5M         | PT1M        |              | 1          |                                                                                                                                                                                                                                                   |
| microsoft.network/virtualNetworkGateways | https://github.com/Azure/alz-monitor/blob/7d0b925a53edf365cee4fae157131420ea29e8c9/Observability_L100/Deploy/policyDefinitions/deploy-vnetg_bgppeerstatus_alert.bicep                   | BgpPeerStatus                                     | Total         | LessThan           | 1           | PT5M         | PT5M        |              |            |                                                                                                                                                                                                                                                   |
| microsoft.network/expressroutegateways   |                                                                                                                                                                                         | ExpressRouteGatewayCpuUtilization                 | Average       | GreaterThan        | 70          | PT5M         | PT1M        |              | 1          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/privateDnsZones        | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-pdnsz_capacityutilization_alert.bicep             | VirtualNetworkLinkCapacityUtilization             | Maximum       | GreaterThanEqualTo | 80          | PT1H         | PT1H        |              | 2          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/privateDnsZones        | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-pdnsz_queryvolume_alert.bicep                     | QueryVolume                                       | Total         | GreaterThanOrEqual | 500         | PT1H         | PT1H        |              | 4          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/privateDnsZones        | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-pdnsz_recordsetcapacity_alert.bicep               | RecordSetCapacityUtilization                      | Maximum       | GreaterThanOrEqual | 75          | PT1H         | PT1H        |              | 2          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/privateDnsZones        | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-pdnsz_registrationcapacityutilization_alert.bicep | VirtualNetworkWithRegistrationCapacityUtilization | Maximum       | GreaterThan        | 90          | PT1H         | PT1H        |              | 2          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/publicIPAddresses      | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-pip_bytesinddosattack_alert.bicep                 | bytesinddos                                       | Maximum       | GreaterThan        | 8000000     | PT5M         | PT5M        |              | 4          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/publicIPAddresses      | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-pip_ddosattack_alert.bicep                        | ifunderddosattack                                 | Maximum       | GreaterThan        | 1           | PT5M         | PT5M        |              | 1          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/publicIPAddresses      | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-pip_packetsinddos_alert.bicep                     | PacketsInDDoS                                     | Total         | GreaterThanEqualTo | 40000       | PT5M         | PT5M        |              | 4          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/publicIPAddresses      | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-pip_vipavailability_alert.bicep                   | VipAvailability                                   | Average       | LessThan           | 1           | PT5M         | PT5M        |              | 1          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworks        | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vnet_ddosattack_alert.bicep                       | ifunderddosattack                                 | Maximum       | GreaterThanOrEqual | 1           | PT5M         | PT5M        |              | 1          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworks        | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vnet_pingavgroundtrip_alert.bicep                 | PingMeshAverageRoundtripMs                        | Average       | GreaterThan        | 300         | PT5M         | PT5M        |              | 4          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworks        | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vnet_probefailed_alert.bicep                      | PingMeshProbesFailedPercent                       | Average       | GreaterThan        | 90          | PT5M         | PT5M        |              | 4          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworkGateways | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vnetg_tunnelbandwidth_alert.bicep                 | TunnelAverageBandwidth                            | Average       | LessThan           | 1           | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworkGateways | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vnetg_tunnelegress_alert.bicep                    | TunnelEgressBytes                                 | Average       | LessThanOrEqual    | 1           | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworkGateways | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vnetg_tunnelingress_alert.bicep                   | TunnelIngressBytes                                | Average       | LessThanOrEqual    | 1           | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |
| microsoft.network/vpngateways            | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vpng_bandwidthutilization_alert.bicep             | tunnelaveragebandwidth                            | Average       | GreaterThan        | 1000000000  | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |
| microsoft.network/vpngateways            | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vpng_egress_alert.bicep                           | tunnelegressbytes                                 | Total         | LessThanOrEqual    | 0           | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |
| microsoft.network/vpngateways            | https://github.com/Azure/alz-monitor/blob/d78aea3853e9839fe87019bc6e9267525bb73102/Observability_L100/Deploy/policyDefinitions/deploy-vpng_ingress_alert.bicep                          | tunnelingressbytes                                | Total         | LessThanOrEqual    | 0           | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworkGateways | https://github.com/Azure/alz-monitor/blob/fdd0ab013ee6f35a53e130384734e20c0a722b54/Observability_L100/Deploy/policyDefinitions/deploy-vpng_ingresspacketdropmismatch_alert.bicep        | TunnelIngressPacketDropTSMismatch                 | Average       | GreaterThan        | 100         | PT5M         | PT5M        |              | 3          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworkGateways |                                                                                                                                                                                         | TunnelEgressPacketDropCount                       | Average       | GreaterThan        | 100         | PT5M         | PT5M        |              | 3          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworkGateways |                                                                                                                                                                                         | TunnelIngressPacketDropCount                      | Average       | GreaterThan        | 100         | PT5M         | PT5M        |              | 3          |                                                                                                                                                                                                                                                   |
| Microsoft.Network/virtualNetworkGateways |                                                                                                                                                                                         | TunnelEgressPacketDropTSMismatch                  | Average       | GreaterThan        | 100         | PT5M         | PT5M        |              | 3          |                                                                                                                                                                                                                                                   |
| microsoft.network/virtualNetworkGateways |                                                                                                                                                                                         | ExpressRouteGatewayBitsPerSecond                  | Average       | LessThanOrEqual    | 1           | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |
| microsoft.network/expressroutegateways   |                                                                                                                                                                                         | ERGatewayConnectionBitsInPerSecond                | Average       | LessThanOrEqual    | 1           | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |
| microsoft.network/expressroutegateways   |                                                                                                                                                                                         | ERGatewayConnectionBitsOutPerSecond               | Average       | LessThanOrEqual    | 1           | PT5M         | PT5M        |              | 0          |                                                                                                                                                                                                                                                   |


## Activity Log Alerts

| Component | Metric |<div style="width:300px">Query</div> |Aggregator | Operator | Threshold | WindowSize | Frequency | Dimensions | Mandatory | Documented |<div style="width:240px">References</div>|
|:----------|:------:|:----------:|:----------:|:--------:|:---------:|:----------:|:---------:|:----------:|:---------:|:----------:|:---------------------------------------|
|||||||||||||

## Log Alerts


| Component | Metric |<div style="width:300px">Query</div> | Aggregator | Operator | Threshold | WindowSize | Frequency | Dimensions | Mandatory | Documented |<div style="width:240px">References</div>|
|:----------|:------:|:------|:----------:|:--------:|:---------:|:----------:|:---------:|:----------:|:---------:|:----------:|:---------------------------------------|
| microsoft.network/expressroutecircuits | BgpAvailability         |`AzureMetrics`<br/>`| where MetricName == "BgpAvailability"`<br/> `| summarize by Average, bin(TimeGenerated, 5m), Resource` <br/> `| render timechart` |0       | LessThan    | 90  | PT5M | PT1M |  Peer | No | Y | [Monitor ExpressRoute Alerts](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#alerts)<br/>[ExpressRoute KQL Queries](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#sample-kusto-queries) |
| microsoft.network/expressroutecircuits | ArpAvailability         |`AzureMetrics`<br/>`| where MetricName == "ArpAvailability"`<br/> `| summarize by Average, bin(TimeGenerated, 5m), Resource` <br/> `| render timechart` |Average | LessThan    | 90  | PT5M | PT1M |  Peer | No | Y | [Monitor ExpressRoute Alerts](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#alerts)<br/>[ExpressRoute KQL Queries](https://docs.microsoft.com/en-us/azure/expressroute/monitor-expressroute#sample-kusto-queries) |
| microsoft.network/expressroutecircuits | BitsInPerSecond  |`AzureMetrics`<br/> `| where MetricName == "BitsInPerSecond"` <br/> `| summarize by Average, bin(TimeGenerated, 1h), Resource` <br/> `| render timechart` |Average | GreaterThan | 100 | PT5M | PT1M | No    | No | N |                                                                                                                                                                                                                                                         |
| microsoft.network/expressroutecircuits | BitsOutPerSecond |```AzureMetrics | where MetricName == "BitsInPerSecond"| summarize by Average, bin(TimeGenerated, 1h), Resource| render timechart``` |Average | GreaterThan | 100 | PT5M | PT1M | No    | No | N |
| microsoft.network/expressroutecircuits | QosDropBitsInPerSecond | `AzureMetrics| where MetricName == "QosDropBitsInPerSecond"` <br/> `| summarize by Average, bin(TimeGenerated, 1h), Resource` <br/> `| render timechart` | Average | GreaterThan | 100 | PT5M | PT1M | No    | No | N |
| microsoft.network/expressroutecircuits | QosDropBitsOutPerSecond | ```AzureMetrics | where MetricName == "QosDropBitsInPerSecond" | summarize by Average, bin(TimeGenerated, 1h), Resource | render timechart```  | Average | GreaterThan | 100 | PT5M | PT1M | No    | No | N |






